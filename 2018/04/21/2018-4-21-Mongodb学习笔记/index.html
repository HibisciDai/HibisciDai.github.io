<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Mongodb学习笔记"><meta name="keywords" content="Mongodb,集群"><meta name="author" content="HibisciDai"><meta name="copyright" content="HibisciDai"><title>Mongodb学习笔记 | HibisciDai</title><link rel="shortcut icon" href="/img/avatar.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="HibisciDai" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NoSQL%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">NoSQL简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%81%B5%E5%BE%AAACID%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">关系型数据库遵循ACID原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.2.</span> <span class="toc-text">分布式系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">1.2.1.</span> <span class="toc-text">分布式计算的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">分布式计算的缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFNoSQL"><span class="toc-number">1.3.</span> <span class="toc-text">什么是NoSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RDBMS-vs-NoSQL"><span class="toc-number">1.4.</span> <span class="toc-text">RDBMS vs NoSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RDBMS"><span class="toc-number">1.4.1.</span> <span class="toc-text">RDBMS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NoSQL"><span class="toc-number">1.4.2.</span> <span class="toc-text">NoSQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CAP%E5%AE%9A%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">CAP定理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NoSQL%E7%9A%84%E4%BC%98%E7%82%B9-%E7%BC%BA%E7%82%B9"><span class="toc-number">1.6.</span> <span class="toc-text">NoSQL的优点&#x2F;缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%82%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">1.6.2.</span> <span class="toc-text">缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E8%A1%8C%E7%9A%84NoSql"><span class="toc-number">1.7.</span> <span class="toc-text">流行的NoSql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%89%8D%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">大数据前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A6%82%E5%BF%B5"><span class="toc-number">2.1.</span> <span class="toc-text">大数据概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">大数据特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">2.3.</span> <span class="toc-text">大数据应用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%EF%BC%88%E7%BE%A4%E9%9B%86%EF%BC%89Cluster"><span class="toc-number">3.</span> <span class="toc-text">集群（群集）Cluster</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E5%88%86%E7%B1%BB"><span class="toc-number">3.3.</span> <span class="toc-text">集群分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-Master-Standby"><span class="toc-number">3.3.1.</span> <span class="toc-text">主备集群(Master-Standby)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4-Master-slave"><span class="toc-number">3.3.2.</span> <span class="toc-text">主从集群(Master-slave)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">负载均衡集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD%E8%AE%A1%E7%AE%97%E9%9B%86%E7%BE%A4"><span class="toc-number">3.3.4.</span> <span class="toc-text">高性能计算集群</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB"><span class="toc-number">4.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD%E7%89%B9%E6%80%A7"><span class="toc-number">4.1.1.</span> <span class="toc-text">主要功能特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">4.1.2.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">4.1.3.</span> <span class="toc-text">适用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%99%90%E5%88%B6"><span class="toc-number">4.1.4.</span> <span class="toc-text">使用限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E4%B8%8E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%AF%94"><span class="toc-number">4.1.5.</span> <span class="toc-text">MongoDB与关系型数据库对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.2.</span> <span class="toc-text">数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.</span> <span class="toc-text">文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88"><span class="toc-number">4.4.</span> <span class="toc-text">集合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%88%E6%B3%95%E7%9A%84%E9%9B%86%E5%90%88%E5%90%8D"><span class="toc-number">4.4.1.</span> <span class="toc-text">合法的集合名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#capped-collections"><span class="toc-number">4.4.2.</span> <span class="toc-text">capped collections</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">4.4.3.</span> <span class="toc-text">元数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.5.</span> <span class="toc-text">MongoDB 数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ObjectId"><span class="toc-number">4.5.1.</span> <span class="toc-text">ObjectId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.5.2.</span> <span class="toc-text">字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E6%88%B3"><span class="toc-number">4.5.3.</span> <span class="toc-text">时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F"><span class="toc-number">4.5.4.</span> <span class="toc-text">日期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">4.6.</span> <span class="toc-text">MongoDB的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#windows-%E4%B8%8B%E5%AE%89%E8%A3%85MongoDB"><span class="toc-number">4.6.1.</span> <span class="toc-text">windows 下安装MongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8MongoDB%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">4.6.2.</span> <span class="toc-text">启动MongoDB服务端:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">4.6.3.</span> <span class="toc-text">MongoDB命令参数说明</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.7.</span> <span class="toc-text">MongoDB - 连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">4.8.</span> <span class="toc-text">MongoDB数据库基本命令:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E6%93%8D%E4%BD%9C%E9%9B%86%E5%90%88%EF%BC%88Collection-%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.8.1.</span> <span class="toc-text">MongoDB操作集合（Collection)相关操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3-Document-%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.8.2.</span> <span class="toc-text">MongoDB操作文档(Document)相关操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E6%9F%A5%E8%AF%A2%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.8.3.</span> <span class="toc-text">MongoDB查询相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">4.8.3.1.</span> <span class="toc-text">基本查询操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.8.3.2.</span> <span class="toc-text">条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">4.8.3.3.</span> <span class="toc-text">逻辑运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E8%BF%90%E7%AE%97"><span class="toc-number">4.8.3.4.</span> <span class="toc-text">集合运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E3%80%81%E6%8E%92%E5%BA%8F%E3%80%81%E5%88%86%E9%A1%B5"><span class="toc-number">4.8.3.5.</span> <span class="toc-text">统计、排序、分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.8.3.6.</span> <span class="toc-text">特殊查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%9A%84%E7%B4%A2%E5%BC%95"><span class="toc-number">4.9.</span> <span class="toc-text">MongoDB的索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="toc-number">4.9.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">4.9.2.</span> <span class="toc-text">普通索引相关命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="toc-number">4.9.3.</span> <span class="toc-text">唯一索引相关命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%9A%84%E5%A4%8D%E5%88%B6"><span class="toc-number">4.10.</span> <span class="toc-text">MongoDB的复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E7%9A%84Master-Slave%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%EF%BC%88%E5%B7%B2%E6%8A%9B%E5%BC%83%EF%BC%89"><span class="toc-number">4.10.1.</span> <span class="toc-text">MongoDB的Master-Slave主从复制（已抛弃）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%A4%8D%E5%88%B6"><span class="toc-number">4.10.1.1.</span> <span class="toc-text">为什么需要复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB%E7%9A%84%E5%A4%8D%E5%88%B6%E6%9E%B6%E6%9E%84"><span class="toc-number">4.10.1.2.</span> <span class="toc-text">MongoDB的复制架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.10.1.3.</span> <span class="toc-text">开发步骤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MongoDB%E7%9A%84Replication-Set%E5%89%AF%E6%9C%AC%E9%9B%86%EF%BC%88%E5%B7%B2%E6%8A%9B%E5%BC%83%EF%BC%89"><span class="toc-number">4.10.2.</span> <span class="toc-text">MongoDB的Replication Set副本集（已抛弃）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MongoDB%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.10.2.1.</span> <span class="toc-text">MongoDB主从复制的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">4.10.2.2.</span> <span class="toc-text">开发步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%9A%84%E5%88%86%E7%89%87"><span class="toc-number">4.11.</span> <span class="toc-text">MongoDB的分片</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%88%86%E7%89%87"><span class="toc-number">4.11.1.</span> <span class="toc-text">为什么需要分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%87%E9%94%AE%EF%BC%88%E5%88%86%E7%89%87%E7%9A%84%E4%BE%9D%E6%8D%AE%EF%BC%89"><span class="toc-number">4.11.2.</span> <span class="toc-text">片键（分片的依据）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%89%87%E6%9E%B6%E6%9E%84"><span class="toc-number">4.11.3.</span> <span class="toc-text">分片架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">4.11.4.</span> <span class="toc-text">开发步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%9A%84JavaDriver"><span class="toc-number">4.12.</span> <span class="toc-text">MongoDB的JavaDriver</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%9C%A8java%E4%B8%AD%E7%9A%84%E6%98%A0%E5%B0%84%E5%AD%98%E5%82%A8"><span class="toc-number">4.13.</span> <span class="toc-text">MongoDB数据结构在java中的映射存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DBObject%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.13.1.</span> <span class="toc-text">DBObject对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BasicDBList%E5%AF%B9%E8%B1%A1-%E9%9B%86%E5%90%88"><span class="toc-number">4.13.2.</span> <span class="toc-text">BasicDBList对象(集合)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">4.14.</span> <span class="toc-text">开发步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo"><span class="toc-number">4.15.</span> <span class="toc-text">Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E6%96%87%E6%A1%A3%EF%BC%88%E5%8D%95%E6%9D%A1%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="toc-number">4.15.1.</span> <span class="toc-text">插入一条文档（单条数据）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E5%B8%A6%E9%9B%86%E5%90%88%E7%9A%84%E6%96%87%E6%A1%A3%EF%BC%88%E5%B8%A6%E9%9B%86%E5%90%88%E7%9A%84%E5%8D%95%E6%9D%A1%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="toc-number">4.15.2.</span> <span class="toc-text">插入一条带集合的文档（带集合的单条数据）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%88%E5%AF%B9%E9%87%8D%E5%A4%8D%E5%86%97%E4%BD%99%E6%93%8D%E4%BD%9C%E4%BB%A3%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%B0%81%E8%A3%85%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-number">4.15.3.</span> <span class="toc-text">针对重复冗余操作代码进行封装工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E6%8F%92%E5%85%A5%E5%A4%9A%E4%B8%AA%E6%96%87%E6%A1%A3%EF%BC%88%E5%A4%9A%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%EF%BC%89"><span class="toc-number">4.15.4.</span> <span class="toc-text">一次插入多个文档（多行数据插入）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%9D%A1%E4%BB%B6%E5%88%A0%E9%99%A4"><span class="toc-number">4.15.5.</span> <span class="toc-text">有条件删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89"><span class="toc-number">4.15.6.</span> <span class="toc-text">删除所有</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9"><span class="toc-number">4.15.7.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89"><span class="toc-number">4.15.8.</span> <span class="toc-text">查询所有</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%9D%A1%E4%BB%B6%E7%9A%84%E6%9F%A5%E8%AF%A21"><span class="toc-number">4.15.9.</span> <span class="toc-text">有条件的查询1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A22"><span class="toc-number">4.15.10.</span> <span class="toc-text">有条件查询2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5"><span class="toc-number">4.15.11.</span> <span class="toc-text">分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F"><span class="toc-number">4.15.12.</span> <span class="toc-text">排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1"><span class="toc-number">4.15.13.</span> <span class="toc-text">统计</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/Avatar.png"></div><div class="author-info__name text-center">HibisciDai</div><div class="author-info__description text-center">HibisciDai'Blog</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">204</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">73</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">29</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://github.com/HibisciDai/hexo-theme-melody">HexoTheme-github</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com/">molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner2.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">HibisciDai</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/about">关于我</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/gallery">相册</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">Mongodb学习笔记</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-21</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">8.6k</span><span class="post-meta__separator">|</span><span>阅读时长: 32 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%B0%81%E9%9D%A2.jpg" class="" title="MongoDB学习笔记封面">
<p>MongoDB，NoSql非关系型数据库，大数据基础课程，学习笔记</p>
<span id="more"></span>
<p>[TOC]</p>
<h1 id="NoSQL简介"><a href="#NoSQL简介" class="headerlink" title="NoSQL简介"></a>NoSQL简介</h1><p>NoSQL(NoSQL = Not Only SQL )，意即”不仅仅是SQL”。<br>传统数据由关系数据库管理系统（RDBMS）来处理。</p>
<h2 id="关系型数据库遵循ACID原则"><a href="#关系型数据库遵循ACID原则" class="headerlink" title="关系型数据库遵循ACID原则"></a>关系型数据库遵循ACID原则</h2><ul>
<li>A (Atomicity) 原子性</li>
</ul>
<p>原子性很容易理解，也就是说事务里的所有操作要么全部做完，要么都不做，事务成功的条件是事务里的所有操作都成功，只要有一个操作失败，整个事务就失败，需要回滚。<br>比如银行转账，从A账户转100元至B账户，分为两个步骤：1）从A账户取100元；2）存入100元至B账户。这两步要么一起完成，要么一起不完成，如果只完成第一步，第二步失败，钱会莫名其妙少了100元。</p>
<ul>
<li>C (Consistency) 一致性</li>
</ul>
<p>一致性也比较容易理解，也就是说数据库要一直处于一致的状态，事务的运行不会改变数据库原本的一致性约束。</p>
<p>例如现有完整性约束a+b=10，如果一个事务改变了a，那么必须得改变b，使得事务结束后依然满足a+b=10，否则事务失败。</p>
<ul>
<li>I (Isolation) 独立性</li>
</ul>
<p>所谓的独立性是指并发的事务之间不会互相影响，如果一个事务要访问的数据正在被另外一个事务修改，只要另外一个事务未提交，它所访问的数据就不受未提交事务的影响。</p>
<p>比如现在有个交易是从A账户转100元至B账户，在这个交易还未完成的情况下，如果此时B查询自己的账户，是看不到新增加的100元的。</p>
<ul>
<li>D (Durability) 持久性</li>
</ul>
<p>持久性是指一旦事务提交后，它所做的修改将会永久的保存在数据库上，即使出现宕机也不会丢失。</p>
<h2 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h2><p>分布式系统（distributed system）由多台计算机和通信的软件组件通过计算机网络连接（本地网络或广域网）组成。<br>分布式系统是建立在网络之上的软件系统。</p>
<h3 id="分布式计算的优点"><a href="#分布式计算的优点" class="headerlink" title="分布式计算的优点"></a>分布式计算的优点</h3><ul>
<li>可靠性（容错） </li>
</ul>
<p>分布式计算系统中的一个重要的优点是可靠性。一台服务器的系统崩溃并不影响到其余的服务器。</p>
<ul>
<li>可扩展性</li>
</ul>
<p>在分布式计算系统可以根据需要增加更多的机器。</p>
<ul>
<li>资源共享</li>
</ul>
<p>共享数据是必不可少的应用，如银行，预订系统。</p>
<ul>
<li>灵活性</li>
</ul>
<p>由于该系统是非常灵活的，它很容易安装，实施和调试新的服务。</p>
<ul>
<li>更快的速度</li>
</ul>
<p>分布式计算系统可以有多台计算机的计算能力，使得它比其他系统有更快的处理速度。</p>
<ul>
<li>开放系统</li>
</ul>
<p>由于它是开放的系统，本地或者远程都可以访问到该服务。</p>
<ul>
<li>更高的性能</li>
</ul>
<p>相较于集中式计算机网络集群可以提供更高的性能（及更好的性价比）。</p>
<h3 id="分布式计算的缺点"><a href="#分布式计算的缺点" class="headerlink" title="分布式计算的缺点"></a>分布式计算的缺点</h3><ul>
<li>故障排除</li>
</ul>
<p>故障排除和诊断问题。</p>
<ul>
<li>软件</li>
</ul>
<p>更少的软件支持是分布式计算系统的主要缺点。</p>
<ul>
<li>网络</li>
</ul>
<p>网络基础设施的问题，包括：传输问题，高负载，信息丢失等。</p>
<ul>
<li>安全性</li>
</ul>
<p>开放系统的特性让分布式计算系统存在着数据的安全性和共享的风险等问题。</p>
<h2 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h2><p>NoSQL，指的是非关系型的数据库。NoSQL有时也称作Not Only SQL的缩写，是对不同于传统的关系型数据库的数据库管理系统的统称。</p>
<p>NoSQL用于超大规模数据的存储。（例如谷歌或Facebook每天为他们的用户收集万亿比特的数据）。这些类型的数据存储不需要固定的模式，无需多余操作就可以横向扩展。</p>
<h2 id="RDBMS-vs-NoSQL"><a href="#RDBMS-vs-NoSQL" class="headerlink" title="RDBMS vs NoSQL"></a>RDBMS vs NoSQL</h2><h3 id="RDBMS"><a href="#RDBMS" class="headerlink" title="RDBMS"></a>RDBMS</h3><ul>
<li>高度组织化结构化数据 </li>
<li>结构化查询语言（SQL） (SQL) </li>
<li>数据和关系都存储在单独的表中。 </li>
<li>数据操纵语言，数据定义语言 </li>
<li>严格的一致性</li>
<li>基础事务</li>
</ul>
<h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><ul>
<li>代表着不仅仅是SQL</li>
<li>没有声明性查询语言</li>
<li>没有预定义的模式</li>
<li>键 - 值对存储，列存储，文档存储，图形数据库</li>
<li>最终一致性，而非ACID属性</li>
<li>非结构化和不可预知的数据</li>
<li>CAP定理 </li>
<li>高性能，高可用性和可伸缩性</li>
</ul>
<h2 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h2><p>在计算机科学中, CAP定理（CAP theorem）, 又被称作 布鲁尔定理（Brewer’s theorem）, 它指出对于一个分布式计算系统来说，不可能同时满足以下三点:</p>
<ul>
<li>一致性(Consistency) (所有节点在同一时间具有相同的数据)</li>
<li>可用性(Availability) (保证每个请求不管成功或者失败都有响应)</li>
<li>分隔容忍(Partition tolerance) (系统中任意信息的丢失或失败不会影响系统的继续运作)</li>
</ul>
<p>根据 CAP 原理将 NoSQL 数据库分成了满足 CA 原则、满足 CP 原则和满足 AP 原则三 大类：</p>
<img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/cap-theoram-image.png" class="" title="cap-theoram">
<ul>
<li>CA<br>单点集群，满足一致性，可用性的系统，通常在可扩展性上不太强大。</li>
<li>CP<br>满足一致性，分区容忍性的系统，通常性能不是特别高。</li>
<li>AP<br>满足可用性，分区容忍性的系统，通常可能对一致性要求低一些。</li>
</ul>
<h2 id="NoSQL的优点-缺点"><a href="#NoSQL的优点-缺点" class="headerlink" title="NoSQL的优点/缺点"></a>NoSQL的优点/缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li>高可扩展性</li>
<li>分布式计算</li>
<li>低成本</li>
<li>架构的灵活性，半结构化数据</li>
<li>没有复杂的关系</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>没有标准化</li>
<li>有限的查询功能（到目前为止）</li>
<li>最终一致是不直观的程序</li>
</ul>
<h2 id="流行的NoSql"><a href="#流行的NoSql" class="headerlink" title="流行的NoSql"></a>流行的NoSql</h2><p>SSDB</p>
<h1 id="大数据前言"><a href="#大数据前言" class="headerlink" title="大数据前言"></a>大数据前言</h1><h2 id="大数据概念"><a href="#大数据概念" class="headerlink" title="大数据概念"></a>大数据概念</h2><p>“大数据”(big  data)是一个体量特别大,数据类别特别大的数据集。</p>
<h2 id="大数据特点"><a href="#大数据特点" class="headerlink" title="大数据特点"></a>大数据特点</h2><ul>
<li>容量（Volume）：  数据的大小决定所考虑的数据的价值和潜在的信息</li>
<li>种类（Variety）： 数据类型的多样性</li>
<li>速度（Velocity）：指获得数据的速度</li>
<li>真实性（Veracity）：数据的质量 </li>
<li>价值（Value）：合理运用大数据，以低成本创造高价值</li>
</ul>
<h2 id="大数据应用场景"><a href="#大数据应用场景" class="headerlink" title="大数据应用场景"></a>大数据应用场景</h2><ul>
<li>医疗大数据  看病更高效</li>
<li>零售大数据  最懂消费者</li>
<li>电商大数据      精准营销法宝</li>
<li>农牧大数据      量化生产</li>
<li>交通大数据      畅通出行</li>
<li>教育大数据      因材施教</li>
<li>环保大数据      对抗PM2.5</li>
<li>食品大数据      舌尖上的安全</li>
</ul>
<h1 id="集群（群集）Cluster"><a href="#集群（群集）Cluster" class="headerlink" title="集群（群集）Cluster"></a>集群（群集）Cluster</h1><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%9B%86%E7%BE%A4%E6%80%BB%E8%BF%B0.png" class="" title="集群总述">
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>多台计算机（服务器），一起对外提供服务</p>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ol>
<li>更加可靠（Hight Avaliable 高可用）</li>
<li>解决单机硬件的物理上限</li>
<li>超级运算（超算）军工 科研</li>
</ol>
<h2 id="集群分类"><a href="#集群分类" class="headerlink" title="集群分类"></a>集群分类</h2><h3 id="主备集群-Master-Standby"><a href="#主备集群-Master-Standby" class="headerlink" title="主备集群(Master-Standby)"></a>主备集群(Master-Standby)</h3><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E4%B8%BB%E5%A4%87%E9%9B%86%E7%BE%A4-Master-Standby.png" class="" title="主备集群">
<h3 id="主从集群-Master-slave"><a href="#主从集群-Master-slave" class="headerlink" title="主从集群(Master-slave)"></a>主从集群(Master-slave)</h3><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4-Master-slave.png" class="" title="主从集群">
<h3 id="负载均衡集群"><a href="#负载均衡集群" class="headerlink" title="负载均衡集群"></a>负载均衡集群</h3><h3 id="高性能计算集群"><a href="#高性能计算集群" class="headerlink" title="高性能计算集群"></a>高性能计算集群</h3><h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><p><a target="_blank" rel="noopener" href="https://www.mongodb.com/">MongoDB的主页</a></p>
<p><strong>MongoDB是一个高性能，开源，无模式的文档型NoSQL数据。</strong></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。</p>
<p>在高负载的情况下，添加更多的节点，可以保证服务器性能。</p>
<p>MongoDB 旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p>
<p>MongoDB 将数据存储为一个文档，数据结构由键值(key=&gt;value)对组成。MongoDB 文档类似于 JSON 对象。字段值可以包含其他文档，数组及文档数组。</p>
<h3 id="主要功能特性"><a href="#主要功能特性" class="headerlink" title="主要功能特性"></a>主要功能特性</h3><ol>
<li>文件存储格式为BSON（一种JSON的扩展）</li>
<li>模式自由</li>
<li>支持动态查询</li>
<li>支持完全索引</li>
<li>支持复制和故障恢复</li>
<li>使用高效的二进制数据存储，包括大型对象（如视频等）</li>
<li>自动处理碎片，以支持云计算层次的扩展性 </li>
<li>支持JAVA,RUBY，PYTHON，C++，PHP等多种语言</li>
<li>内部支持JavaScript</li>
</ol>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ol>
<li>查询速度快。</li>
<li>高并发。可以达到2万个并发</li>
<li>高容量。支持10TB以上的数据量</li>
</ol>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ol>
<li>网站数据</li>
<li>缓存</li>
<li>大尺寸、低价值的数据</li>
<li>高伸缩性的场景</li>
<li>用于对象及JSON数据的存储</li>
</ol>
<h3 id="使用限制"><a href="#使用限制" class="headerlink" title="使用限制"></a>使用限制</h3><ol>
<li>在32位系统上，不支持大于2.5G的数据</li>
<li>单个文件大小限制为16M</li>
<li>高度事务性的系统：例如银行或会计系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。</li>
<li>传统的商业智能应用：针对特定问题的BI数据库会对产生高度优化的查询方式。对于此类应用，数据仓库可能是更合适的选择。   </li>
</ol>
<h3 id="MongoDB与关系型数据库对比"><a href="#MongoDB与关系型数据库对比" class="headerlink" title="MongoDB与关系型数据库对比"></a>MongoDB与关系型数据库对比</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">对比项</th>
<th style="text-align:center">MongoDB</th>
<th style="text-align:center">MySQL、Oracle</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据库</td>
<td style="text-align:center">数据库(dataBase)</td>
<td style="text-align:center">数据库(dataBase、schema)</td>
</tr>
<tr>
<td style="text-align:center">表</td>
<td style="text-align:center">集合(collection)</td>
<td style="text-align:center">二维表(table)</td>
</tr>
<tr>
<td style="text-align:center">表中的一行数据</td>
<td style="text-align:center">文档(document)</td>
<td style="text-align:center">一条记录(record)</td>
</tr>
<tr>
<td style="text-align:center">表字段</td>
<td style="text-align:center">键(key)</td>
<td style="text-align:center">列(column)</td>
</tr>
<tr>
<td style="text-align:center">主外键</td>
<td style="text-align:center">无</td>
<td style="text-align:center">PK、FK</td>
</tr>
<tr>
<td style="text-align:center">灵活度扩展性</td>
<td style="text-align:center">极高</td>
<td style="text-align:center">差</td>
</tr>
</tbody>
</table>
</div>
<img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E4%B8%8E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%AF%94.png" class="" title="MongoDB与关系型数据库对比">
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>一个mongodb中可以建立多个数据库。</p>
<p>MongoDB的默认数据库为”db”，该数据库存储在data目录中。</p>
<p>MongoDB的单个实例可以容纳多个独立的数据库，每一个都有自己的集合和权限，不同的数据库也放置在不同的文件中。</p>
<p><em>数据库也通过名字来标识。数据库名可以是满足以下条件的任意UTF-8字符串。</em></p>
<ul>
<li>不能是空字符串（””)。</li>
<li>不得含有’ ‘（空格)、.、$、/、\和\0 (空字符)。</li>
<li>应全部小写。</li>
<li>最多64字节。</li>
</ul>
<p><em>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。</em></p>
<ul>
<li>admin<br>从权限的角度来看，这是<code>root</code>数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。</li>
<li>local<br>这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li>
<li>config<br>当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。</li>
</ul>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p>文档是一组键值(key-value)对(即BSON)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">RDBMS</th>
<th style="text-align:center">MongoDB</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据库</td>
<td style="text-align:center">数据库</td>
</tr>
<tr>
<td style="text-align:center">表格</td>
<td style="text-align:center">集合</td>
</tr>
<tr>
<td style="text-align:center">行</td>
<td style="text-align:center">文档</td>
</tr>
<tr>
<td style="text-align:center">列</td>
<td style="text-align:center">字段</td>
</tr>
<tr>
<td style="text-align:center">表联合</td>
<td style="text-align:center">嵌入文档</td>
</tr>
<tr>
<td style="text-align:center">主键</td>
<td style="text-align:center">主键 (MongoDB 提供了 key 为 _id )</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据库服务和客户端</th>
<th style="text-align:center"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Mysqld/Oracle</td>
<td style="text-align:center">mongod</td>
</tr>
<tr>
<td style="text-align:center">mysql/sqlplus</td>
<td style="text-align:center">mongo</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>需要注意的是</li>
</ul>
<ol>
<li>文档中的键/值对是有序的。</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</li>
<li>MongoDB区分类型和大小写。</li>
<li>MongoDB的文档不能有重复的键。</li>
<li>文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</li>
</ol>
<ul>
<li>文档键命名规范</li>
</ul>
<ol>
<li>键不能含有\0 (空字符)。这个字符用来表示键的结尾。</li>
<li>.和$有特别的意义，只有在特定环境下才能使用。</li>
<li>以下划线<code>_</code>开头的键是保留的(不是严格要求的)。</li>
</ol>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表格。</p>
<p>集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。</p>
<h3 id="合法的集合名"><a href="#合法的集合名" class="headerlink" title="合法的集合名"></a>合法的集合名</h3><ol>
<li>集合名不能是空字符串<code>&quot;&quot;</code>。</li>
<li>集合名不能含有\0字符（空字符)，这个字符表示集合名的结尾。</li>
<li>集合名不能以”system.”开头，这是为系统集合保留的前缀。</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现<code>$</code>。</li>
</ol>
<h3 id="capped-collections"><a href="#capped-collections" class="headerlink" title="capped collections"></a>capped collections</h3><p>Capped collections 就是固定大小的collection。</p>
<p>它有很高的性能以及队列过期的特性(过期按照插入的顺序). 有点和 “RRD” 概念类似。</p>
<p>Capped collections是高性能自动的维护对象的插入顺序。它非常适合类似记录日志的功能 和标准的collection不同，你必须要显式的创建一个capped collection， 指定一个collection的大小，单位是字节。collection的数据存储空间值提前分配的。</p>
<p>要注意的是指定的存储大小包含了数据库的头信息。</p>
<ol>
<li>在capped collection中，你能添加新的对象。</li>
<li>更新，然而，对象不会增加存储空间。如果增加，更新就会失败 。</li>
<li>不允许进行删除。使用<code>rop()</code>删除collection所有的行。</li>
<li>删除之后，你必须显式的重新创建这个collection。</li>
<li>it机器中，capped collection最大存储为1e9( 1X109)个字节。</li>
</ol>
<h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">集合命名空间</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">dbname.system.namespaces</td>
<td style="text-align:center">列出所有名字空间。</td>
</tr>
<tr>
<td style="text-align:center">dbname.system.indexes</td>
<td style="text-align:center">列出所有索引。</td>
</tr>
<tr>
<td style="text-align:center">dbname.system.profile</td>
<td style="text-align:center">包含数据库概要(profile)信息。</td>
</tr>
<tr>
<td style="text-align:center">dbname.system.users</td>
<td style="text-align:center">列出所有可访问数据库的用户。</td>
</tr>
<tr>
<td style="text-align:center">dbname.local.sources</td>
<td style="text-align:center">包含复制对端（slave）的服务器信息和状态。</td>
</tr>
</tbody>
</table>
</div>
<p>在<code>&#123; &#123; system.indexes &#125; &#125;</code>插入数据，可以创建索引。但除此之外该表信息是不可变的(特殊的drop index命令将自动更新相关信息)。</p>
<p><code>&#123; &#123; system.users &#125; &#125;</code>是可修改的。</p>
<p><code>&#123; &#123; system.profile &#125; &#125;</code>是可删除的。</p>
<h2 id="MongoDB-数据类型"><a href="#MongoDB-数据类型" class="headerlink" title="MongoDB 数据类型"></a>MongoDB 数据类型</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">数据类型</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">String</td>
<td style="text-align:center">字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。</td>
</tr>
<tr>
<td style="text-align:center">Integer</td>
<td style="text-align:center">整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。</td>
</tr>
<tr>
<td style="text-align:center">Boolean</td>
<td style="text-align:center">布尔值。用于存储布尔值（真/假）。</td>
</tr>
<tr>
<td style="text-align:center">Double</td>
<td style="text-align:center">双精度浮点值。用于存储浮点值。</td>
</tr>
<tr>
<td style="text-align:center">Min/Max keys</td>
<td style="text-align:center">将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。</td>
</tr>
<tr>
<td style="text-align:center">Array</td>
<td style="text-align:center">用于将数组或列表或多个值存储为一个键。</td>
</tr>
<tr>
<td style="text-align:center">Timestamp</td>
<td style="text-align:center">时间戳。记录文档修改或添加的具体时间。</td>
</tr>
<tr>
<td style="text-align:center">Object</td>
<td style="text-align:center">用于内嵌文档。</td>
</tr>
<tr>
<td style="text-align:center">Null</td>
<td style="text-align:center">用于创建空值。</td>
</tr>
<tr>
<td style="text-align:center">Symbol</td>
<td style="text-align:center">符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。</td>
</tr>
<tr>
<td style="text-align:center">Date</td>
<td style="text-align:center">日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。</td>
</tr>
<tr>
<td style="text-align:center">Object ID</td>
<td style="text-align:center">对象 ID。用于创建文档的 ID。</td>
</tr>
<tr>
<td style="text-align:center">Binary Data</td>
<td style="text-align:center">二进制数据。用于存储二进制数据。</td>
</tr>
<tr>
<td style="text-align:center">Code</td>
<td style="text-align:center">代码类型。用于在文档中存储 JavaScript 代码。</td>
</tr>
<tr>
<td style="text-align:center">Regular expression</td>
<td style="text-align:center">正则表达式类型。用于存储正则表达式。</td>
</tr>
</tbody>
</table>
</div>
<h3 id="ObjectId"><a href="#ObjectId" class="headerlink" title="ObjectId"></a>ObjectId</h3><p>ObjectId 类似唯一主键，可以很快的去生成和排序，包含 12 bytes，含义是：</p>
<ol>
<li>前 4 个字节表示创建 unix时间戳,格林尼治时间 UTC 时间，比北京时间晚了 8 个小时</li>
<li>接下来的 3 个字节是机器标识码</li>
<li>紧接的两个字节由进程 id 组成 PID</li>
<li>最后三个字节是随机数</li>
</ol>
<img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ObjectId.jpeg" class="" title="ObjectId">
<p>MongoDB 中存储的文档必须有一个<code>_id</code>键。这个键的值可以是任何类型的，默认是个 ObjectId 对象。</p>
<p>由于 ObjectId 中保存了创建的时间戳，所以你不需要为你的文档保存时间戳字段，你可以通过 getTimestamp 函数来获取文档的创建时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; var newObject = ObjectId()</span><br><span class="line">&gt; newObject.getTimestamp()</span><br><span class="line"></span><br><span class="line">ISODate(&quot;2017-11-25T07:21:10Z&quot;)</span><br></pre></td></tr></table></figure>
<p>ObjectId 转为字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; newObject.str</span><br><span class="line"></span><br><span class="line">5a1919e63df83ce79df8b38f</span><br></pre></td></tr></table></figure>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>BSON 字符串都是 UTF-8 编码。</p>
<h3 id="时间戳"><a href="#时间戳" class="headerlink" title="时间戳"></a>时间戳</h3><p>BSON 有一个特殊的时间戳类型用于 MongoDB 内部使用，与普通的 日期 类型不相关。 时间戳值是一个 64 位的值。其中：</p>
<ul>
<li>前32位是一个 time_t 值（与Unix新纪元相差的秒数）</li>
<li>后32位是在某秒中操作的一个递增的序数<br>在单个 mongod 实例中，时间戳值通常是唯一的。</li>
</ul>
<p>在复制集中， oplog 有一个 ts 字段。这个字段中的值使用BSON时间戳表示了操作时间。</p>
<blockquote>
<p>BSON 时间戳类型主要用于 MongoDB 内部使用。在大多数情况下的应用开发中，你可以使用 BSON 日期类型。</p>
</blockquote>
<h3 id="日期"><a href="#日期" class="headerlink" title="日期"></a>日期</h3><p>表示当前距离 Unix新纪元（1970年1月1日）的毫秒数。日期类型是有符号的, 负数表示 1970 年之前的日期。</p>
<h2 id="MongoDB的安装"><a href="#MongoDB的安装" class="headerlink" title="MongoDB的安装"></a>MongoDB的安装</h2><ol>
<li>从官方获得MongoDB的压缩包</li>
<li>将其解压到 d:\，再重命名为mongo，路径为d:\mongo</li>
<li>创建MongoDB的数据文件夹</li>
</ol>
<h3 id="windows-下安装MongoDB"><a href="#windows-下安装MongoDB" class="headerlink" title="windows 下安装MongoDB"></a>windows 下安装MongoDB</h3><p><em>zip版，mis版本不再介绍</em></p>
<p>搭建文件目录路径如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">├─mongodb</span><br><span class="line">│  └─bin</span><br><span class="line">├─mongodbdata</span><br><span class="line">├─mongodetc</span><br><span class="line">└─mongodlog</span><br></pre></td></tr></table></figure>
<p><code>mongodb</code> 为主文件目录，其中 <code>bin</code> 为主要目录<br><code>mongodbdata</code> 为数据库目录<br><code>mongodetc</code> 为配置文件目录<br><code>mongodlog</code> 为日志目录</p>
<ul>
<li>设置数据库位置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod.exe --dbpath G:\mongodb\mongodbdata</span><br></pre></td></tr></table></figure>
<ul>
<li>设置目录文件</li>
</ul>
<p>对应一个文件，而不是目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod.exe --logpath g:\mongodb\mongodlog\mongodlog</span><br></pre></td></tr></table></figure>
<p>另外可以书写配置文件编写bat批处理一键启动服务</p>
<ul>
<li>编写配置文件</li>
</ul>
<p><code>mongod.cfg</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">    destination: file</span><br><span class="line">    path: g:\mongodb\mongodlog\mongodlog</span><br><span class="line">storage:</span><br><span class="line">    dbPath: g:\mongodb\mongodbdata</span><br></pre></td></tr></table></figure>
<ul>
<li>以配置文件安装服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod.exe --config &quot;g:\mongodb\mongodetc\ongod.cfg&quot; --install</span><br></pre></td></tr></table></figure>
<ul>
<li>以配置文件启动服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g:\mongodb\mongodb\bin\mongod.exe --config g:\mongodb\mongodetc\mongod.cfg</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="启动MongoDB服务端"><a href="#启动MongoDB服务端" class="headerlink" title="启动MongoDB服务端:"></a>启动MongoDB服务端:</h3><p>d:\mongo\bin\<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=d:\db --logpath=c:\mongo\logs       \mongodb.log --port=27017</span><br></pre></td></tr></table></figure></p>
<h3 id="MongoDB命令参数说明"><a href="#MongoDB命令参数说明" class="headerlink" title="MongoDB命令参数说明"></a>MongoDB命令参数说明</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">名称</th>
<th style="text-align:center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">dbpath</td>
<td style="text-align:center">数据文件存放路径，每个数据库会在其中创建一个子目录，用于防止同一个实例多次运行的mongod.lock  也保存在此目录中</td>
</tr>
<tr>
<td style="text-align:center">logpath</td>
<td style="text-align:center">日志文件</td>
</tr>
<tr>
<td style="text-align:center">logappend</td>
<td style="text-align:center">日志采用追加模式（默认是覆写模式）</td>
</tr>
<tr>
<td style="text-align:center">bind_ip</td>
<td style="text-align:center">对外服务的绑定ip，一般设置为空，及绑定在本机所有可用ip 上</td>
</tr>
<tr>
<td style="text-align:center">port</td>
<td style="text-align:center">对外服务端口。Web  管理端口在这个port  的基础上+1000</td>
</tr>
<tr>
<td style="text-align:center">fork</td>
<td style="text-align:center">以后台Daemon  形式运行服务</td>
</tr>
<tr>
<td style="text-align:center">journal</td>
<td style="text-align:center">开启日志功能，通过保存操作日志来降低单机故障的恢复时间</td>
</tr>
<tr>
<td style="text-align:center">syncdelay</td>
<td style="text-align:center">系统同步刷新磁盘的时间，单位为秒，默认是60 秒</td>
</tr>
<tr>
<td style="text-align:center">directoryperdb</td>
<td style="text-align:center">每个db 存放在单独的目录中，建议设置该参数</td>
</tr>
<tr>
<td style="text-align:center">maxConns</td>
<td style="text-align:center">最大连接数</td>
</tr>
<tr>
<td style="text-align:center">repairpath</td>
<td style="text-align:center">执行repair  时的临时目录。在如果没有开启journal，异常down  机后重启，必须执行repair操作</td>
</tr>
</tbody>
</table>
</div>
<h2 id="MongoDB-连接"><a href="#MongoDB-连接" class="headerlink" title="MongoDB - 连接"></a>MongoDB - 连接</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</span><br></pre></td></tr></table></figure>
<ul>
<li>mongodb://<br>这是固定的格式，必须要指定。</li>
<li>username:password@<br>可选项，如果设置，在连接数据库服务器之后，驱动都会尝试登陆这个数据库</li>
<li>host1<br>必须的指定至少一个<code>host</code>, <code>host1</code> 是这个URI唯一要填写的。它指定了要连接服务器的地址。如果要连接复制集，请指定多个主机地址。</li>
<li>portX<br>可选的指定端口，如果不填，默认为<code>27017</code></li>
<li>/database<br>如果指定<code>username:password@</code>，连接并验证登陆指定数据库。若不指定，默认打开 test 数据库。</li>
<li>?options<br>是连接选项。如果不使用<code>/database</code>，则前面需要加上<code>/</code>。所有连接选项都是键值对<code>name=value</code>，键值对之间通过<code>&amp;</code>或<code>;</code>（分号）隔开</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">选项</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">replicaSet=name</td>
<td style="text-align:left">验证replica set的名称。 Impliesconnect=replicaSet.</td>
</tr>
<tr>
<td style="text-align:center">slaveOk=true\</td>
<td style="text-align:left">false 或 true:在connect=direct模式下，驱动会连接第一台机器，即使这台服务器不是主。在connect=replicaSet模式下，驱动会发送所有的写请求到主并且把读取操作分布在其他从服务器。false: 在 connect=direct模式下，驱动会自动找寻主服务器. 在connect=replicaSet 模式下，驱动仅仅连接主服务器，并且所有的读写命令都连接到主服务器。</td>
</tr>
<tr>
<td style="text-align:center">safe=true\</td>
<td style="text-align:left">false 或 true: 在执行更新操作之后，驱动都会发送getLastError命令来确保更新成功。(还要参考 wtimeoutMS).false: 在每次更新之后，驱动不会发送getLastError来确保更新成功。</td>
</tr>
<tr>
<td style="text-align:center">w=n</td>
<td style="text-align:left">驱动添加 { w : n } 到getLastError命令. 应用于safe=true。</td>
</tr>
<tr>
<td style="text-align:center">wtimeoutMS=ms</td>
<td style="text-align:left">驱动添加 { wtimeout : ms } 到 getlasterror 命令. 应用于 safe=true.</td>
</tr>
<tr>
<td style="text-align:center">fsync=true\</td>
<td style="text-align:left">false 或 true: 驱动添加 { fsync : true } 到 getlasterror 命令.应用于 safe=true.false: 驱动不会添加到getLastError命令中。</td>
</tr>
<tr>
<td style="text-align:center">journal=true\</td>
<td style="text-align:left">false 或 如果设置为 true, 同步到 journal (在提交到数据库前写入到实体中). 应用于 safe=true</td>
</tr>
<tr>
<td style="text-align:center">connectTimeoutMS=ms</td>
<td style="text-align:left">可以打开连接的时间。</td>
</tr>
<tr>
<td style="text-align:center">socketTimeoutMS=ms</td>
<td style="text-align:left">发送和接受sockets的时间。</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>使用默认端口来连接 MongoDB 的服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongodb://localhost</span><br></pre></td></tr></table></figure>
<ul>
<li>通过 shell 连接 MongoDB 服务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./mongo</span><br><span class="line">MongoDB shell version: 3.0.6</span><br><span class="line">connecting to: test</span><br><span class="line">... </span><br></pre></td></tr></table></figure>
<h2 id="MongoDB数据库基本命令"><a href="#MongoDB数据库基本命令" class="headerlink" title="MongoDB数据库基本命令:"></a>MongoDB数据库基本命令:</h2><ol>
<li>Help查看命令提示</li>
</ol>
<p><code>db.help()</code></p>
<ol>
<li>显示当前数据库的名字</li>
</ol>
<p><code>db</code></p>
<ol>
<li>切换/创建数据库</li>
</ol>
<p><code>use 数据库名</code><br>当创建一个集合的时候会自动创建当前数据库</p>
<ol>
<li>显示所有的数据库</li>
</ol>
<p><code>show dbs</code></p>
<ol>
<li>删除当前数据库</li>
</ol>
<p><code>db.dropDatabase()</code></p>
<ol>
<li>显示当前db状态</li>
</ol>
<p><code>db.stats()</code></p>
<ol>
<li>当前db版本</li>
</ol>
<p><code>db.version()</code></p>
<ol>
<li>查看当前db的链接机器地址</li>
</ol>
<p><code>db.getMongo()</code></p>
<h3 id="MongoDB操作集合（Collection-相关操作"><a href="#MongoDB操作集合（Collection-相关操作" class="headerlink" title="MongoDB操作集合（Collection)相关操作"></a>MongoDB操作集合（Collection)相关操作</h3><ol>
<li>创建集合</li>
</ol>
<p>显示创建:</p>
<p><code>db.createCollection(“users”);</code></p>
<p>隐式创建(直接向集合插入数据):</p>
<p><code>db.users.insert(&#123;name:”suns”,age:10&#125;)</code></p>
<ol>
<li>显示当前数据库中的所有集合</li>
</ol>
<p><code>show collections</code><br><code>show tables</code></p>
<ol>
<li>删除集合</li>
</ol>
<p><code>db.users.drop()</code></p>
<h3 id="MongoDB操作文档-Document-相关操作"><a href="#MongoDB操作文档-Document-相关操作" class="headerlink" title="MongoDB操作文档(Document)相关操作"></a>MongoDB操作文档(Document)相关操作</h3><ol>
<li>创建文档</li>
</ol>
<p>文档格式遵从<em>json</em>格式</p>
<p><code>db.users.insert(&#123;name:”suns”,age:10&#125;)</code><br>自动生成一个全球唯一的主键，文档主键<code>_id</code>：时间戳、机器、PID、计数器</p>
<ol>
<li>删除文档</li>
</ol>
<p><code>db.users.remove(&#123;&#125;)</code></p>
<p><code>db.users.remove(&#123;name:”suns”&#125;)</code></p>
<ol>
<li>修改文档</li>
</ol>
<p><code>db.users.update(query,update,upsert,multi)</code></p>
<p><code>query</code><br>修改的条件，若为<code>&#123;&#125;</code> 则全选</p>
<p><code>update</code><br>更新的命令</p>
<p><code>upsert</code><br>如果未发现符合要求的数据内容，是否进行插入操作，1或者true 进行插入，0或者false不进行插入</p>
<p><code>multi</code>   是否进行多行更新，1或者true 进行多行更新，0或者false不进行多行更新</p>
<ol>
<li>修改文档具体案例</li>
</ol>
<p><code>db.users.update(&#123;name:”suns”&#125;,&#123;$set:&#123;password:”888”&#125;&#125;,0, 1)</code> </p>
<p><code>$set</code>等同于sql语句中的set</p>
<p><code>$inc</code>为对应key中的数据内容进行算数运算（增加）</p>
<p><code>db.users.update(&#123;&#125;,&#123;$inc:&#123;age:1&#125;,0,1&#125;)</code></p>
<h3 id="MongoDB查询相关操作"><a href="#MongoDB查询相关操作" class="headerlink" title="MongoDB查询相关操作"></a>MongoDB查询相关操作</h3><h4 id="基本查询操作"><a href="#基本查询操作" class="headerlink" title="基本查询操作"></a>基本查询操作</h4><p>查询集合中所有内容:<code>db.users.find();</code></p>
<p>查询集合中第一个内容:<code>db.users.findOne();</code></p>
<h4 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h4><ul>
<li><code>=</code> 条件 </li>
</ul>
<pre><code class="lang-db.users.find(&#123;name:”suns”&#125;)```">
- `!=` 条件 `$ne`

```db.users.find(&#123;name:&#123;“$ne”:”suns”&#125;&#125;)
</code></pre>
<ul>
<li><code>&gt;</code> 条件 <code>$gt</code></li>
</ul>
<pre><code class="lang-db.users.find(&#123;age:&#123;“$gt”:10&#125;&#125;)```">
- `&lt;` 条件 `$lt`

```db.users.find(&#123;age:&#123;“$lt”:10&#125;&#125;)
</code></pre>
<ul>
<li><code>&gt;=</code> 条件 <code>$gte</code></li>
</ul>
<pre><code class="lang-db.users.find(&#123;age:&#123;“$gte”:10&#125;&#125;)```">
- `&lt;=` 条件 `$lte`

```db.users.find(&#123;age:&#123;“$lte”:10&#125;&#125;)
</code></pre>
<h4 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h4><ul>
<li>与运算</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;name:”suns”,age:10&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>或运算</li>
</ul>
<p><code>$or</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;$or:[&#123;name:”suns1”&#125;,&#123;age:32&#125;]&#125;)   </span><br></pre></td></tr></table></figure>
<ul>
<li>或非运算</li>
</ul>
<p><code>$nor</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;$nor:[&#123;name:”suns1”&#125;,&#123;age:32&#125;]&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h4><ul>
<li><code>$in</code> </li>
</ul>
<p>类似于关系型数据库中的in操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;age:&#123;$in:[23,24,25]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>$all</code> </li>
</ul>
<p>主要用来查询数组中的包含关系，查询条件中只要有一个不包含就不返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[1,2,3]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[2,3,4]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[2,5,7]&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;suns1&quot;,&quot;post&quot;:[3,9,10]&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;post:&#123;$all:[2,3]&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>一行二行出现23</p>
<h4 id="统计、排序、分页"><a href="#统计、排序、分页" class="headerlink" title="统计、排序、分页"></a>统计、排序、分页</h4><ul>
<li>统计</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.count();//统计数据</span><br><span class="line">db.users.find().count();</span><br><span class="line">db.users.find(&#123;age:&#123;$lt:5&#125;&#125;).count();//条件统计</span><br></pre></td></tr></table></figure>
<ul>
<li>排序</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().sort(&#123;age:1&#125;); //升序</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;); //降序</span><br></pre></td></tr></table></figure>
<ul>
<li>分页</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.users.find().skip(2).limit(3); #从第三条开始，三个为一页</span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3); #在上一个基础上以年龄为降序排列</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在上述基础进行统计</span></span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3).count(0); </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">忽略分页效果</span></span><br><span class="line">db.users.find().sort(&#123;age:-1&#125;).skip(2).limit(3).count(1);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">记录分页效果</span></span><br></pre></td></tr></table></figure>
<h4 id="特殊查询"><a href="#特殊查询" class="headerlink" title="特殊查询"></a>特殊查询</h4><ul>
<li>投影查询</li>
</ul>
<p>排除某个列，类似于<code>select 列名</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;&#125;,&#123;_id:0&#125;)</span><br></pre></td></tr></table></figure></p>
<p><code>$exists</code> 判断一个key是否存在 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;name:&#123;$exists:1&#125;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="MongoDB的索引"><a href="#MongoDB的索引" class="headerlink" title="MongoDB的索引"></a>MongoDB的索引</h2><h3 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h3><p>索引就是用来加速查询的。数据库索引与书籍的索引类似：有了索引就不需要翻遍整本书，数据库则可以直接在索引中查找，使得查找速度能提高几个数量级。在索引中找到条目以后，就可以直接跳转到目标文档的位置。</p>
<p>类似字典中拼音部首。</p>
<h3 id="普通索引相关命令"><a href="#普通索引相关命令" class="headerlink" title="普通索引相关命令"></a>普通索引相关命令</h3><ul>
<li>为某个键创建索引</li>
</ul>
<p>默认为id创建索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.ensureIndex(&#123;键值:1&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>查看关于索引的相关信息</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.stats()</span><br></pre></td></tr></table></figure>
<ul>
<li>查看查询使用索引的情况</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(&#123;键值:value&#125;).explain()</span><br></pre></td></tr></table></figure>
<ul>
<li>删除索引</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.ropIndex(&#123;键值:1&#125;)</span><br></pre></td></tr></table></figure>
<p>删除集合，也会将集合中的索引全部删除</p>
<h3 id="唯一索引相关命令"><a href="#唯一索引相关命令" class="headerlink" title="唯一索引相关命令"></a>唯一索引相关命令</h3><ul>
<li>创建唯一索引 </li>
</ul>
<p>保证每个键的唯一性</p>
<pre><code class="lang-db.集合名称.ensureIndex(&#123;键值:1&#125;，&#123;unique:true&#125;)```">
- 查看关于索引的相关信息

```db.集合名称.stats()
</code></pre>
<ul>
<li>查看查询使用索引的情况</li>
</ul>
<pre><code class="lang-db.集合名称.find(&#123;键值:value&#125;).explain()```">
- 删除索引

```db.集合名称.dropIndex(&#123;键值:1&#125;)
</code></pre>
<p>删除集合，也会将集合中的索引全部删除</p>
<h2 id="MongoDB的复制"><a href="#MongoDB的复制" class="headerlink" title="MongoDB的复制"></a>MongoDB的复制</h2><h3 id="MongoDB的Master-Slave主从复制（已抛弃）"><a href="#MongoDB的Master-Slave主从复制（已抛弃）" class="headerlink" title="MongoDB的Master-Slave主从复制（已抛弃）"></a>MongoDB的Master-Slave主从复制（已抛弃）</h3><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E7%9A%84Master-Slave%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B61.png" class="" title="MongoDB的Master-Slave主从复制1">
<h4 id="为什么需要复制"><a href="#为什么需要复制" class="headerlink" title="为什么需要复制"></a>为什么需要复制</h4><ol>
<li>单节点故障（主备）</li>
<li>读写分离（主从）</li>
</ol>
<h4 id="MongoDB的复制架构"><a href="#MongoDB的复制架构" class="headerlink" title="MongoDB的复制架构"></a>MongoDB的复制架构</h4><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E7%9A%84Master-Slave%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B62.png" class="" title="MongoDB的Master-Slave主从复制2">
<h4 id="开发步骤"><a href="#开发步骤" class="headerlink" title="开发步骤"></a>开发步骤</h4><ol>
<li>准备3个数据文件目录</li>
</ol>
<p>mongodata1(主）mongodata2(从）mongodata3(从）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├─mongodb</span><br><span class="line">│  └─bin</span><br><span class="line">├─mongodbdata</span><br><span class="line">│  ├─diagnostic.data</span><br><span class="line">│  └─journal</span><br><span class="line">├─mongodbdata1 #</span><br><span class="line">├─mongodbdata2 #</span><br><span class="line">├─mongodbdata3 #</span><br><span class="line">├─mongodetc</span><br><span class="line">└─mongodlog</span><br></pre></td></tr></table></figure>
<ol>
<li>​</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=&quot;G:/mongodb/mongodbdata&quot; --master --port 11111</span><br><span class="line"></span><br><span class="line">mongod --dbpath=&quot;G:/mongodb/mongodbdata2&quot; --slave --port 22222 --source 127.0.0.1:11111</span><br><span class="line"></span><br><span class="line">mongod --dbpath=&quot;G:/mongodb/mongodbdata3&quot;  --slave –-port 33333 --source 127.0.0.1:11111</span><br></pre></td></tr></table></figure>
<h3 id="MongoDB的Replication-Set副本集（已抛弃）"><a href="#MongoDB的Replication-Set副本集（已抛弃）" class="headerlink" title="MongoDB的Replication Set副本集（已抛弃）"></a>MongoDB的Replication Set副本集（已抛弃）</h3><h4 id="MongoDB主从复制的问题"><a href="#MongoDB主从复制的问题" class="headerlink" title="MongoDB主从复制的问题"></a>MongoDB主从复制的问题</h4><p>主节点宕机，从节点不能对外提供服务，只能作为数据的备份</p>
<h4 id="开发步骤-1"><a href="#开发步骤-1" class="headerlink" title="开发步骤"></a>开发步骤</h4><ol>
<li>准备3个数据文件目录 </li>
</ol>
<p>mongodata1(主）mongodata2(从）mongodata3(从）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├─mongodb</span><br><span class="line">│  └─bin</span><br><span class="line">├─mongodbdata</span><br><span class="line">│  ├─diagnostic.data</span><br><span class="line">│  └─journal</span><br><span class="line">├─mongodbdata1 #</span><br><span class="line">├─mongodbdata2 #</span><br><span class="line">├─mongodbdata3 #</span><br><span class="line">├─mongodetc</span><br><span class="line">└─mongodlog</span><br></pre></td></tr></table></figure>
<ol>
<li>​</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod -port 11111 --dbpath=&quot;d:\mongodata1&quot; --replSet baizhi</span><br><span class="line">mongod -port 22222 --dbpath=&quot;d:\mongodata2&quot; --replSet baizhi</span><br><span class="line">mongod -port 33333 --dbpath=&quot;d:\mongodata3&quot; --replSet baizhi</span><br></pre></td></tr></table></figure>
<ol>
<li>​</li>
</ol>
<p>第一个服务器启动后作主节点执行下列代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config_baizhi=&#123;&quot;_id&quot;:&quot;baizhi&quot;,&quot;members&quot;:[&#123;_id:0,host:&quot;localhost:11111&quot;&#125;,&#123;_id:1,host:&quot;localhost:22222&quot;&#125;, &#123;_id:2,host:&quot;localhost:33333&quot;&#125;]&#125;;</span><br><span class="line">rs.initiate(config_baizhi); </span><br></pre></td></tr></table></figure>
<blockquote>
<p>从节点需要执行 <code>rs.slaveOK()</code> 实现可读<br>查看节点状态 <code>rs.status()</code></p>
</blockquote>
<h2 id="MongoDB的分片"><a href="#MongoDB的分片" class="headerlink" title="MongoDB的分片"></a>MongoDB的分片</h2><h3 id="为什么需要分片"><a href="#为什么需要分片" class="headerlink" title="为什么需要分片"></a>为什么需要分片</h3><p>一千万个文档中查找一条数据</p>
<p>将一千万个数据分成十个节点（服务器）每个100万条</p>
<img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E7%9A%84%E5%88%86%E7%89%87-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%88%86%E7%89%87.png" class="" title="MongoDB的分片-为什么需要分片">
<ul>
<li>好处</li>
</ul>
<p>提高查询效率，提高并发量</p>
<h3 id="片键（分片的依据）"><a href="#片键（分片的依据）" class="headerlink" title="片键（分片的依据）"></a>片键（分片的依据）</h3><img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E7%9A%84%E5%88%86%E7%89%87-%E7%89%87%E9%94%AE.png" class="" title="MongoDB的分片-片键">
<h3 id="分片架构"><a href="#分片架构" class="headerlink" title="分片架构"></a>分片架构</h3><p>先从ConfigDB读取片键后去查询</p>
<img src="/2018/04/21/2018-4-21-Mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/MongoDB%E7%9A%84%E5%88%86%E7%89%87-%E5%88%86%E7%89%87%E6%9E%B6%E6%9E%84.png" class="" title="MongoDB的分片-分片架构">
<h3 id="开发步骤-2"><a href="#开发步骤-2" class="headerlink" title="开发步骤"></a>开发步骤</h3><ul>
<li>准备三个数据库，configdb（配置库）、shard1（数据库1）、shard2（数据库2）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath=&quot;d:/configdb&quot; --port 11111</span><br><span class="line">mongod --dbpath=&quot;d:/shard1&quot; –port 22222</span><br><span class="line">mongod --dbpath=&quot;d:/shard2&quot; –port 33333</span><br></pre></td></tr></table></figure>
<ul>
<li>启动mongos服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongos --port 44444 --configdb localhost:11111</span><br></pre></td></tr></table></figure>
<ul>
<li>登录到mongos</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo localhost:44444/admin</span><br></pre></td></tr></table></figure>
<ul>
<li>指定存储数据的节点</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;addshard:&quot;localhost:22222&quot;,allowLocal:true&#125;)db.runCommand(&#123;addshard:&quot;localhost:33333&quot;,allowLocal:true&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>指定分片的数据库</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;&quot;enablesharding&quot;:&quot;baizhi&quot;&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>指定分片的集合与片键</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.runCommand(&#123;&quot;shardcollection&quot;:&quot;baizhi.users&quot;,&quot;key&quot;:&#123;&quot;name&quot;:1&#125;&#125;) </span><br></pre></td></tr></table></figure>
<ul>
<li>数据插入测试</li>
</ul>
<blockquote>
<p>mongodb支持javascript语法</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (var i=0;i&lt;100000;i++) &#123;</span><br><span class="line">    db.users.insert(&#123;name:&quot;hibiscidai&quot;+i&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进入不同数据库节点进行统计数据查询，片键决定分区存储大小，根据实际需求。</p>
<h2 id="MongoDB的JavaDriver"><a href="#MongoDB的JavaDriver" class="headerlink" title="MongoDB的JavaDriver"></a>MongoDB的JavaDriver</h2><h2 id="MongoDB数据结构在java中的映射存储"><a href="#MongoDB数据结构在java中的映射存储" class="headerlink" title="MongoDB数据结构在java中的映射存储"></a>MongoDB数据结构在java中的映射存储</h2><h3 id="DBObject对象"><a href="#DBObject对象" class="headerlink" title="DBObject对象"></a>DBObject对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;name:<span class="string">&quot;suns&quot;</span>,pwd:<span class="string">&quot;123&quot;</span>&#125;</span><br><span class="line">	↓</span><br><span class="line">Map.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;suns&quot;</span>)</span><br><span class="line">	↓</span><br><span class="line">DBObject</span><br><span class="line">	↓</span><br><span class="line">BasicDBObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;suns&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="BasicDBList对象-集合"><a href="#BasicDBList对象-集合" class="headerlink" title="BasicDBList对象(集合)"></a>BasicDBList对象(集合)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;suns&quot;</span>,<span class="string">&quot;date1&quot;</span>,<span class="string">&quot;date2&quot;</span>]</span><br><span class="line">	↓</span><br><span class="line">ArrayList</span><br><span class="line">	↓</span><br><span class="line">BasicDBlist.add(<span class="string">&quot;suns);</span></span><br></pre></td></tr></table></figure>
<h2 id="开发步骤-3"><a href="#开发步骤-3" class="headerlink" title="开发步骤"></a>开发步骤</h2><ul>
<li>导入jar包</li>
<li>创建连接对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MongoClient</span> <span class="variable">mongo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MongoClient</span>(ip,port);</span><br></pre></td></tr></table></figure>
<ul>
<li>获取数据对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DB</span> <span class="variable">db</span> <span class="operator">=</span> mongo.getDB(“dbname”);</span><br></pre></td></tr></table></figure>
<ul>
<li>获得Collection对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DBCollection</span> <span class="variable">dbCollection</span> <span class="operator">=</span> db.getCollection(“collectionName”);</span><br></pre></td></tr></table></figure>
<ul>
<li>调用DBCollection对象的相关方法，完成CURD</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dbCollection.insert()	→	db.users.insert()</span><br><span class="line">dbCollection.find()		→	db.users.find()</span><br><span class="line">dbCollection.findOne()	→	db.users.findOne()</span><br><span class="line">dbCollection.update()	→	db.users.update()</span><br><span class="line">dbCollection.remove()	→	db.users.remove()</span><br></pre></td></tr></table></figure>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><h3 id="插入一条文档（单条数据）"><a href="#插入一条文档（单条数据）" class="headerlink" title="插入一条文档（单条数据）"></a>插入一条文档（单条数据）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//db.users.insert(&#123;name:&quot;suns&quot;,pwd:&quot;123&quot;&quot;&#125;);</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testinsert1</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">MongoClient</span> <span class="variable">mongoClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//连接到MOingoDB数据库</span></span><br><span class="line">        mongoClient = <span class="keyword">new</span> <span class="title class_">MongoClient</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">27017</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取操作的目标数据库</span></span><br><span class="line">        <span class="type">DB</span> <span class="variable">db</span> <span class="operator">=</span> mogoClient.getDB(<span class="string">&quot;hibiscidai&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取插入的集合目标</span></span><br><span class="line">        <span class="type">DBcollection</span> <span class="variable">collection</span> <span class="operator">=</span> db.getCollection(<span class="string">&quot;users&quot;</span>);</span><br><span class="line">        </span><br><span class="line">		<span class="comment">//准备数据</span></span><br><span class="line">        <span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">        basicDBObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;hibiscidai&quot;</span>);</span><br><span class="line">        basicDBObject.put(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//执行操作</span></span><br><span class="line">        collection.insert(basicDBObject);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//关闭连接</span></span><br><span class="line">        mongoClient.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="插入一条带集合的文档（带集合的单条数据）"><a href="#插入一条带集合的文档（带集合的单条数据）" class="headerlink" title="插入一条带集合的文档（带集合的单条数据）"></a>插入一条带集合的文档（带集合的单条数据）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//db.users.insert(&#123;name:&quot;suna&quot;,post:&quot;1,6,8,10&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testinsert2</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">MongoClient</span> <span class="variable">mongoClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//连接到MOingoDB数据库</span></span><br><span class="line">        mongoClient = <span class="keyword">new</span> <span class="title class_">MongoClient</span>(<span class="string">&quot;127.0.01&quot;</span>,<span class="number">27017</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取操作的数据库</span></span><br><span class="line">        <span class="type">DB</span> <span class="variable">db</span> <span class="operator">=</span> mogoClient.getDB(<span class="string">&quot;hibiscidai&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取插入的集合目标</span></span><br><span class="line">        <span class="type">DBcollection</span> <span class="variable">collection</span> <span class="operator">=</span> db.getCollection(<span class="string">&quot;users&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//准备数据</span></span><br><span class="line">        <span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">        basicDBObject.put(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;suns&quot;</span>)</span><br><span class="line">        <span class="type">BasicDBList</span> <span class="variable">basicDBList</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBList</span>();</span><br><span class="line">        basicDBList.add(<span class="number">1</span>);</span><br><span class="line">        basicDBList.add(<span class="number">6</span>);</span><br><span class="line">        basicDBList.add(<span class="number">8</span>);</span><br><span class="line">        basicDBList.add(<span class="number">10</span>);</span><br><span class="line">        basicDBObject.put(<span class="string">&quot;post&quot;</span>,basicDBList);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//执行操作</span></span><br><span class="line">        collection.insert(basicDBObject);</span><br><span class="line">	&#125;  <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//关闭连接</span></span><br><span class="line">        mongoClient.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="针对重复冗余操作代码进行封装工具类"><a href="#针对重复冗余操作代码进行封装工具类" class="headerlink" title="针对重复冗余操作代码进行封装工具类"></a>针对重复冗余操作代码进行封装工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MongoUtil</span> &#123;</span><br><span class="line">	<span class="comment">// 一次连接设置</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> MongoClient mongonClient;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取集合</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> DBCollection <span class="title function_">getCollection</span><span class="params">(String ip, Integer port, String dbName, String collectionName)</span> &#123;</span><br><span class="line">		<span class="comment">// 连接数据库</span></span><br><span class="line">		<span class="type">DBCollection</span> <span class="variable">dBCollection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			mongonClient = <span class="keyword">new</span> <span class="title class_">MongoClient</span>(ip, port.intValue());</span><br><span class="line">			<span class="comment">// 获取数据库</span></span><br><span class="line">			<span class="type">DB</span> <span class="variable">getDb</span> <span class="operator">=</span> mongonClient.getDB(dbName);</span><br><span class="line">			<span class="comment">// 获取插入的目标集合</span></span><br><span class="line">			dBCollection = getDb.getCollection(collectionName);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> dBCollection;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 关闭连接</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeConnection</span><span class="params">()</span> &#123;</span><br><span class="line">		mongonClient.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一次插入多个文档（多行数据插入）"><a href="#一次插入多个文档（多行数据插入）" class="headerlink" title="一次插入多个文档（多行数据插入）"></a>一次插入多个文档（多行数据插入）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testinsert3</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">MongoClient</span> <span class="variable">mongoClient</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 获取连接</span></span><br><span class="line">		<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;hibiscidai&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 构建数据</span></span><br><span class="line">		<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">		basicDBObject.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;hibiscidai1&quot;</span>);</span><br><span class="line">		<span class="type">DBObject</span> <span class="variable">basicDBObject1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">		basicDBObject1.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;hibiscidai2&quot;</span>);</span><br><span class="line">		<span class="type">DBObject</span> <span class="variable">basicDBObject2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">		basicDBObject2.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;hibiscidai3&quot;</span>);</span><br><span class="line">		<span class="comment">// 创建list集合接收DBObject</span></span><br><span class="line">		List&lt;DBObject&gt; l = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;DBObject&gt;();</span><br><span class="line">		l.add(basicDBObject);</span><br><span class="line">		l.add(basicDBObject1);</span><br><span class="line">		l.add(basicDBObject2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 执行操作</span></span><br><span class="line">		collection.insert(l);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 关闭连接</span></span><br><span class="line">		MongoUtil.closeConnection();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="有条件删除"><a href="#有条件删除" class="headerlink" title="有条件删除"></a>有条件删除</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.remove(&#123;name:&quot;zkf1&quot;&#125;)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testdelete</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取对应集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject对象</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();<span class="comment">// &#123;&#125;</span></span><br><span class="line">			basicDBObject.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zkf1&quot;</span>);</span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			collection.remove(basicDBObject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除所有"><a href="#删除所有" class="headerlink" title="删除所有"></a>删除所有</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.remove(&#123;&#125;)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testdelte2</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject对象</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();<span class="comment">// &#123;&#125;</span></span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			collection.remove(basicDBObject);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.update(&#123;name:&quot;zkf1&quot;&#125;,&#123;$set:&#123;age:78&#125;&#125;,0,1)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testupdate1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zkf1&quot;</span>);<span class="comment">// &#123;name:&quot;zkf1&quot;&#125;</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject2.put(<span class="string">&quot;age&quot;</span>, <span class="number">78</span>);<span class="comment">// &#123;age:78&#125;</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject3.put(<span class="string">&quot;$set&quot;</span>, basicDBObject2);<span class="comment">// &#123;$set:&#123;age:78&#125;&#125;</span></span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			collection.update(basicDBObject, basicDBObject3, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查询所有"><a href="#查询所有" class="headerlink" title="查询所有"></a>查询所有</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.find();</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testfind</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 执行命令</span></span><br><span class="line">			<span class="type">DBCursor</span> <span class="variable">dbCursor</span> <span class="operator">=</span> collection.find();</span><br><span class="line">			<span class="comment">// 每一个DBOBject对象对应一个文档</span></span><br><span class="line">			<span class="keyword">for</span> (DBObject dbObject : dbCursor) &#123;</span><br><span class="line">				System.out.println(dbObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="有条件的查询1"><a href="#有条件的查询1" class="headerlink" title="有条件的查询1"></a>有条件的查询1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.find(&#123;name:&quot;zkf3&quot;&#125;)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testfind1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject对象</span></span><br><span class="line">			<span class="type">BasicDBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zkf3&quot;</span>);<span class="comment">// &#123;name:&quot;zkf3&quot;&#125;</span></span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			<span class="type">DBCursor</span> <span class="variable">dbCursor</span> <span class="operator">=</span> collection.find(basicDBObject);</span><br><span class="line">			<span class="keyword">for</span> (DBObject dbObject : dbCursor) &#123;</span><br><span class="line">				System.out.println(dbObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="有条件查询2"><a href="#有条件查询2" class="headerlink" title="有条件查询2"></a>有条件查询2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.find(&#123;age:&#123;&quot;$gte&quot;:38&#125;&#125;)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testfind2</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject.put(<span class="string">&quot;$gte&quot;</span>, <span class="number">38</span>);<span class="comment">// &#123;&quot;$gte&quot;:38&#125;</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject2.put(<span class="string">&quot;age&quot;</span>, basicDBObject);<span class="comment">// &#123;age:&#123;&quot;$gte&quot;:38&#125;&#125;</span></span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			<span class="type">DBCursor</span> <span class="variable">dbCursor</span> <span class="operator">=</span> collection.find(basicDBObject2);</span><br><span class="line">			<span class="keyword">for</span> (DBObject dbObject : dbCursor) &#123;</span><br><span class="line">				System.out.println(dbObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.find().skip(0).limit(3)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testfen</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 执行操作</span></span><br><span class="line">			<span class="type">DBCursor</span> <span class="variable">dbCursor</span> <span class="operator">=</span> collection.find().skip(<span class="number">3</span>).limit(<span class="number">3</span>);</span><br><span class="line">			<span class="keyword">for</span> (DBObject dbObject : dbCursor) &#123;</span><br><span class="line">				System.out.println(dbObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.find().sort(&#123;age:-1&#125;)</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testsort</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 创建BasicDBObject</span></span><br><span class="line">			<span class="type">DBObject</span> <span class="variable">basicDBObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicDBObject</span>();</span><br><span class="line">			basicDBObject.put(<span class="string">&quot;age&quot;</span>, <span class="number">1</span>);<span class="comment">// &#123;age:-1&#125;</span></span><br><span class="line">			<span class="comment">// 执行操作命令</span></span><br><span class="line">			<span class="type">DBCursor</span> <span class="variable">dbCursor</span> <span class="operator">=</span> collection.find().sort(basicDBObject);</span><br><span class="line">			<span class="keyword">for</span> (DBObject dbObject : dbCursor) &#123;</span><br><span class="line">				System.out.println(dbObject);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.users.count()</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testcount</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 获取目标集合</span></span><br><span class="line">			<span class="type">DBCollection</span> <span class="variable">collection</span> <span class="operator">=</span> MongoUtil.getCollection(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">27017</span>, <span class="string">&quot;baizhi&quot;</span>, <span class="string">&quot;users&quot;</span>);</span><br><span class="line">			<span class="comment">// 执行操作命令</span></span><br><span class="line">			<span class="type">long</span> <span class="variable">l</span> <span class="operator">=</span> collection.count();</span><br><span class="line">			System.out.println(l);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 关闭连接</span></span><br><span class="line">			MongoUtil.closeConnection();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">HibisciDai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hibiscidai.com/2018/04/21/2018-4-21-Mongodb学习笔记/">http://hibiscidai.com/2018/04/21/2018-4-21-Mongodb学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hibiscidai.com">HibisciDai</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Mongodb/">Mongodb</a><a class="post-meta__tags" href="/tags/%E9%9B%86%E7%BE%A4/">集群</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/zhifubaodashang.jpg"><div class="post-qr-code__desc">支付宝打赏</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="/img/weixin.png"><div class="post-qr-code__desc">微信打赏</div></div></div><div class="social-share pull-right" data-disabled="linkedin,diandian"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/04/23/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-11-%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"><i class="fa fa-chevron-left">  </i><span>设计模式-11-外观模式</span></a></div><div class="next-post pull-right"><a href="/2018/04/18/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-10-%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F/"><span>设计模式-10-装饰器模式</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTQ2NC8xMjAwMA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer class="footer-bg" style="background-image: url(/img/banner2.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2023 By HibisciDai</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>