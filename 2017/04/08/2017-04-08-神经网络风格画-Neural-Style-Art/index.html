<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="神经网络风格画 Neural Style Art"><meta name="keywords" content="算法,神经网络风格画"><meta name="author" content="HibisciDai"><meta name="copyright" content="HibisciDai"><title>神经网络风格画 Neural Style Art | HibisciDai</title><link rel="shortcut icon" href="/img/avatar.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="manifest" href="/manifest.json"><link rel="manifest" href="/manifest.json"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="HibisciDai" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Neural-Style-%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">Neural Style 项目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%89%8D%E5%87%86%E5%A4%87"><span class="toc-number">3.</span> <span class="toc-text">项目部署前准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windws%E4%B8%8B%E8%BD%BDVM%E4%B8%AD%E5%AE%89%E8%A3%85Ubuntu"><span class="toc-number">3.1.</span> <span class="toc-text">Windws下载VM中安装Ubuntu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VM%E4%B8%ADUbuntu%E7%9A%84%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">VM中Ubuntu的网络配置</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E"><span class="toc-number">4.</span> <span class="toc-text">项目部署安装说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4%E9%83%A8%E7%BD%B2%E7%9A%84Linux%E6%9C%BA%E5%99%A8%E6%8B%A5%E6%9C%89git%E5%92%8Ccmake"><span class="toc-number">4.1.</span> <span class="toc-text">确认部署的Linux机器拥有git和cmake</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9AInstall-torch7"><span class="toc-number">4.2.</span> <span class="toc-text">步骤一：Install torch7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%AE%89%E8%A3%85loadcaffe"><span class="toc-number">4.3.</span> <span class="toc-text">步骤二：安装loadcaffe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%AE%89%E8%A3%85neural-style"><span class="toc-number">4.4.</span> <span class="toc-text">步骤三：安装neural-style</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8B%E9%9A%86%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.4.1.</span> <span class="toc-text">克隆项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.4.2.</span> <span class="toc-text">下载模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CPU%E6%A8%A1%E5%BC%8F%E4%B8%8B%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">4.4.3.</span> <span class="toc-text">CPU模式下运行测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%BE%93%E5%87%BA%E8%A7%A3%E9%87%8A"><span class="toc-number">4.4.4.</span> <span class="toc-text">测试输出解释</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GPU%E6%A8%A1%E5%BC%8F%E4%B8%8B%E8%BF%90%E8%A1%8C"><span class="toc-number">5.</span> <span class="toc-text">GPU模式下运行</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/Avatar.png"></div><div class="author-info__name text-center">HibisciDai</div><div class="author-info__description text-center">HibisciDai'Blog</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">224</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">77</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">30</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友情链接</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://github.com/HibisciDai/hexo-theme-melody">HexoTheme-github</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com/">molunerfinn</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/banner2.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">HibisciDai</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/about">关于我</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/gallery">相册</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title">神经网络风格画 Neural Style Art</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-04-08</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AF%BE%E5%A4%96%E6%89%A9%E5%B1%95/">课外扩展</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>[TOC]</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>博主看到了一篇知乎上有关于代码实现照片滤镜的文章<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/26066756?utm_source=qq&amp;utm_medium=social">安利一个很火的 Github 滤镜项目</a><br>照片风格迁移<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21978527">7 个 App 可让你的照片变成艺术品</a></p>
<span id="more"></span>
<h1 id="Neural-Style-项目"><a href="#Neural-Style-项目" class="headerlink" title="Neural Style 项目"></a>Neural Style 项目</h1><p>博主目前的水平还看不懂整个项目的代码跟底层算法实现到底是什么原理<br>google+baidu了一番很是想要亲自体验下这个算法，美化一下自己的照片。<br>下边是github上neural-style项目的主页：<br><a target="_blank" rel="noopener" href="https://github.com/jcjohnson/neural-style">neural-style | github</a><br>安装说明：<br><a target="_blank" rel="noopener" href="https://github.com/jcjohnson/neural-style/blob/master/INSTALL.md">neural-style | github | 安装使用说明</a></p>
<h1 id="项目部署前准备"><a href="#项目部署前准备" class="headerlink" title="项目部署前准备"></a>项目部署前准备</h1><p>可以了解到该项目代码基于 Torch，并已经在 Ubuntu 14.04 LTS 系统测试。目前尚未搜索到在windows上跑起来的案例。<br>并且项目介绍说到GPU下跑的要比CPU效果好，可是博主对于GPU模式并没有研究，遂查了很多案例，博主准备在<strong>windows7下利用VMare安装Ubuntu进行项目部署。</strong></p>
<p><a target="_blank" rel="noopener" href="http://wiki.ubuntu.org.cn/Ubuntu%E6%A1%8C%E9%9D%A2%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97">Ubuntu桌面入门指南</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/e1f9126846ff">深度学习neural-style环境搭建 | 简书</a></p>
<h2 id="Windws下载VM中安装Ubuntu"><a href="#Windws下载VM中安装Ubuntu" class="headerlink" title="Windws下载VM中安装Ubuntu"></a>Windws下载VM中安装Ubuntu</h2><p><a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/14bd256e0ca52ebb6d26129c.html">怎样在VMware虚拟机中使用安装并设置Ubuntu系统 | 百度经验</a></p>
<h2 id="VM中Ubuntu的网络配置"><a href="#VM中Ubuntu的网络配置" class="headerlink" title="VM中Ubuntu的网络配置"></a>VM中Ubuntu的网络配置</h2><p>请参考<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/wuxianglong/article/details/6126942">虚拟机安装Ubuntu的上网设置（有线网络和无线网络）</a><br>需要注意的是Ubuntu在VM下NAT模式网络连接注意本机需要开启两个服务<br><code>VMware NAT Service</code><br><code>VMware DHCP Service（可不开）</code></p>
<h1 id="项目部署安装说明"><a href="#项目部署安装说明" class="headerlink" title="项目部署安装说明"></a>项目部署安装说明</h1><p>详细请参考github中项目简介，过程博主出现各种问题，主要google+百度+翻遍issues解决，感触就是<strong>别放弃</strong>。</p>
<h2 id="确认部署的Linux机器拥有git和cmake"><a href="#确认部署的Linux机器拥有git和cmake" class="headerlink" title="确认部署的Linux机器拥有git和cmake"></a>确认部署的Linux机器拥有git和cmake</h2><p>没有的通过命令<br><code>sudo apt-get install git</code>安装git<br>cmake安装直接google</p>
<h2 id="步骤一：Install-torch7"><a href="#步骤一：Install-torch7" class="headerlink" title="步骤一：Install torch7"></a>步骤一：Install torch7</h2><p><code>cd ~/
curl -s https://raw.githubusercontent.com/torch/ezinstall/master/install-deps | bash
git clone https://github.com/torch/distro.git ~/torch --recursive
cd ~/torch; ./install.sh
source ~/.bashrc</code></p>
<p>还有 <code>sudo apt-get install libreadline-dev</code></p>
<h2 id="步骤二：安装loadcaffe"><a href="#步骤二：安装loadcaffe" class="headerlink" title="步骤二：安装loadcaffe"></a>步骤二：安装loadcaffe</h2><p><code>sudo apt-get install libprotobuf-dev protobuf-compiler</code></p>
<p><code>luarocks install loadcaffe</code></p>
<h2 id="步骤三：安装neural-style"><a href="#步骤三：安装neural-style" class="headerlink" title="步骤三：安装neural-style"></a>步骤三：安装neural-style</h2><h3 id="克隆项目"><a href="#克隆项目" class="headerlink" title="克隆项目"></a>克隆项目</h3><p><code>cd ~/
git clone https://github.com/jcjohnson/neural-style.git
cd neural-style</code></p>
<h3 id="下载模型"><a href="#下载模型" class="headerlink" title="下载模型"></a>下载模型</h3><p><code>sh models/download_models.sh</code></p>
<h3 id="CPU模式下运行测试"><a href="#CPU模式下运行测试" class="headerlink" title="CPU模式下运行测试"></a>CPU模式下运行测试</h3><p><code>th neural_style.lua -gpu -1 -print_iter 1</code><br>上一行是官方给的测试语句，博主在解决以上所有步骤后在此步骤卡了好长时间。<br>第一次，终端提示RAM不够，重启VM更改设置增到2G内存。RAM报错解决。<br>第二次，终端报错 <code>No LuaRocks module found for cutorch</code>，找到对应Issues<a target="_blank" rel="noopener" href="https://github.com/jcjohnson/neural-style/issues/320">No LuaRocks module found for cutorch</a>遂发现Troch7装载过程有问题，重装。</p>
<h3 id="测试输出解释"><a href="#测试输出解释" class="headerlink" title="测试输出解释"></a>测试输出解释</h3><p>官方给出的样例输出即为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[libprotobuf WARNING google/protobuf/io/coded_stream.cc:505] Reading dangerously large protocol message.  If the message turns out to be larger than 1073741824 bytes, parsing will be halted for security reasons.  To increase the limit (or to disable these warnings), see CodedInputStream::SetTotalBytesLimit() in google/protobuf/io/coded_stream.h.</span><br><span class="line">[libprotobuf WARNING google/protobuf/io/coded_stream.cc:78] The total number of bytes read was 574671192</span><br><span class="line">Successfully loaded models/VGG_ILSVRC_19_layers.caffemodel</span><br><span class="line">conv1_1: 64 3 3 3</span><br><span class="line">conv1_2: 64 64 3 3</span><br><span class="line">conv2_1: 128 64 3 3</span><br><span class="line">conv2_2: 128 128 3 3</span><br><span class="line">conv3_1: 256 128 3 3</span><br><span class="line">conv3_2: 256 256 3 3</span><br><span class="line">conv3_3: 256 256 3 3</span><br><span class="line">conv3_4: 256 256 3 3</span><br><span class="line">conv4_1: 512 256 3 3</span><br><span class="line">conv4_2: 512 512 3 3</span><br><span class="line">conv4_3: 512 512 3 3</span><br><span class="line">conv4_4: 512 512 3 3</span><br><span class="line">conv5_1: 512 512 3 3</span><br><span class="line">conv5_2: 512 512 3 3</span><br><span class="line">conv5_3: 512 512 3 3</span><br><span class="line">conv5_4: 512 512 3 3</span><br><span class="line">fc6: 1 1 25088 4096</span><br><span class="line">fc7: 1 1 4096 4096</span><br><span class="line">fc8: 1 1 4096 1000</span><br><span class="line">WARNING: Skipping content loss	</span><br><span class="line">Iteration 1 / 1000	</span><br><span class="line">  Content 1 loss: 2091178.593750	</span><br><span class="line">  Style 1 loss: 30021.292114	</span><br><span class="line">  Style 2 loss: 700349.560547	</span><br><span class="line">  Style 3 loss: 153033.203125	</span><br><span class="line">  Style 4 loss: 12404635.156250	</span><br><span class="line">  Style 5 loss: 656.860304	</span><br><span class="line">  Total loss: 15379874.666090	</span><br><span class="line">Iteration 2 / 1000	</span><br><span class="line">  Content 1 loss: 2091177.343750	</span><br><span class="line">  Style 1 loss: 30021.292114	</span><br><span class="line">  Style 2 loss: 700349.560547	</span><br><span class="line">  Style 3 loss: 153033.203125	</span><br><span class="line">  Style 4 loss: 12404633.593750	</span><br><span class="line">  Style 5 loss: 656.860304	</span><br><span class="line">  Total loss: 15379871.853590	</span><br></pre></td></tr></table></figure>
<p>其中这段是Troch输出。<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">conv1_1: 64 3 3 3</span><br><span class="line">conv1_2: 64 64 3 3</span><br><span class="line">conv2_1: 128 64 3 3</span><br><span class="line">conv2_2: 128 128 3 3</span><br><span class="line">conv3_1: 256 128 3 3</span><br><span class="line">conv3_2: 256 256 3 3</span><br><span class="line">conv3_3: 256 256 3 3</span><br><span class="line">conv3_4: 256 256 3 3</span><br><span class="line">conv4_1: 512 256 3 3</span><br><span class="line">conv4_2: 512 512 3 3</span><br><span class="line">conv4_3: 512 512 3 3</span><br><span class="line">conv4_4: 512 512 3 3</span><br><span class="line">conv5_1: 512 512 3 3</span><br><span class="line">conv5_2: 512 512 3 3</span><br><span class="line">conv5_3: 512 512 3 3</span><br><span class="line">conv5_4: 512 512 3 3</span><br><span class="line">fc6: 1 1 25088 4096</span><br><span class="line">fc7: 1 1 4096 4096</span><br><span class="line">fc8: 1 1 4096 1000</span><br></pre></td></tr></table></figure><br>真正的Neural Style项目输出才是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">WARNING: Skipping content loss	</span><br><span class="line">Iteration 1 / 1000	</span><br><span class="line">  Content 1 loss: 2091178.593750	</span><br><span class="line">  Style 1 loss: 30021.292114	</span><br><span class="line">  Style 2 loss: 700349.560547	</span><br><span class="line">  Style 3 loss: 153033.203125	</span><br><span class="line">  Style 4 loss: 12404635.156250	</span><br><span class="line">  Style 5 loss: 656.860304	</span><br><span class="line">  Total loss: 15379874.666090	</span><br><span class="line">Iteration 2 / 1000	</span><br><span class="line">  Content 1 loss: 2091177.343750	</span><br><span class="line">  Style 1 loss: 30021.292114	</span><br><span class="line">  Style 2 loss: 700349.560547	</span><br><span class="line">  Style 3 loss: 153033.203125	</span><br><span class="line">  Style 4 loss: 12404633.593750	</span><br><span class="line">  Style 5 loss: 656.860304	</span><br><span class="line">  Total loss: 15379871.853590	</span><br></pre></td></tr></table></figure>
<p>关于<code>WARNING: Skipping content loss</code>此句，博主本机上并没有出现此类信息<br>代码显示如下，此为Neural Style输出代码<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Setting up style layer  	2	:	relu1_1	</span><br><span class="line">Setting up style layer  	7	:	relu2_1	</span><br><span class="line">Setting up style layer  	12	:	relu3_1	</span><br><span class="line">Setting up style layer  	21	:	relu4_1	</span><br><span class="line">Setting up content layer	23	:	relu4_2	</span><br><span class="line">Setting up style layer  	30	:	relu5_1	</span><br><span class="line">Capturing content targets	</span><br><span class="line">nn.Sequential &#123;</span><br><span class="line">  [input -&gt; (1) -&gt; (2) -&gt; (3) -&gt; (4) -&gt; (5) -&gt; (6) -&gt; (7) -&gt; (8) -&gt; (9) -&gt; (10) -&gt; (11) -&gt; (12) -&gt; (13) -&gt; (14) -&gt; (15) -&gt; (16) -&gt; (17) -&gt; (18) -&gt; (19) -&gt; (20) -&gt; (21) -&gt; (22) -&gt; (23) -&gt; (24) -&gt; (25) -&gt; (26) -&gt; (27) -&gt; (28) -&gt; (29) -&gt; (30) -&gt; (31) -&gt; (32) -&gt; (33) -&gt; (34) -&gt; (35) -&gt; (36) -&gt; (37) -&gt; output]</span><br><span class="line">  (1): nn.TVLoss</span><br><span class="line">  (2): nn.SpatialConvolution(3 -&gt; 64, 3x3, 1,1, 1,1)</span><br><span class="line">  (3): nn.ReLU</span><br><span class="line">  (4): nn.StyleLoss</span><br><span class="line">  (5): nn.SpatialConvolution(64 -&gt; 64, 3x3, 1,1, 1,1)</span><br><span class="line">  (6): nn.ReLU</span><br><span class="line">  (7): nn.SpatialMaxPooling(2x2, 2,2)</span><br><span class="line">  (8): nn.SpatialConvolution(64 -&gt; 128, 3x3, 1,1, 1,1)</span><br><span class="line">  (9): nn.ReLU</span><br><span class="line">  (10): nn.StyleLoss</span><br><span class="line">  (11): nn.SpatialConvolution(128 -&gt; 128, 3x3, 1,1, 1,1)</span><br><span class="line">  (12): nn.ReLU</span><br><span class="line">  (13): nn.SpatialMaxPooling(2x2, 2,2)</span><br><span class="line">  (14): nn.SpatialConvolution(128 -&gt; 256, 3x3, 1,1, 1,1)</span><br><span class="line">  (15): nn.ReLU</span><br><span class="line">  (16): nn.StyleLoss</span><br><span class="line">  (17): nn.SpatialConvolution(256 -&gt; 256, 3x3, 1,1, 1,1)</span><br><span class="line">  (18): nn.ReLU</span><br><span class="line">  (19): nn.SpatialConvolution(256 -&gt; 256, 3x3, 1,1, 1,1)</span><br><span class="line">  (20): nn.ReLU</span><br><span class="line">  (21): nn.SpatialConvolution(256 -&gt; 256, 3x3, 1,1, 1,1)</span><br><span class="line">  (22): nn.ReLU</span><br><span class="line">  (23): nn.SpatialMaxPooling(2x2, 2,2)</span><br><span class="line">  (24): nn.SpatialConvolution(256 -&gt; 512, 3x3, 1,1, 1,1)</span><br><span class="line">  (25): nn.ReLU</span><br><span class="line">  (26): nn.StyleLoss</span><br><span class="line">  (27): nn.SpatialConvolution(512 -&gt; 512, 3x3, 1,1, 1,1)</span><br><span class="line">  (28): nn.ReLU</span><br><span class="line">  (29): nn.ContentLoss</span><br><span class="line">  (30): nn.SpatialConvolution(512 -&gt; 512, 3x3, 1,1, 1,1)</span><br><span class="line">  (31): nn.ReLU</span><br><span class="line">  (32): nn.SpatialConvolution(512 -&gt; 512, 3x3, 1,1, 1,1)</span><br><span class="line">  (33): nn.ReLU</span><br><span class="line">  (34): nn.SpatialMaxPooling(2x2, 2,2)</span><br><span class="line">  (35): nn.SpatialConvolution(512 -&gt; 512, 3x3, 1,1, 1,1)</span><br><span class="line">  (36): nn.ReLU</span><br><span class="line">  (37): nn.StyleLoss</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>第三次，基于以上运行后，出现 <code>已杀死</code> 即 <code>killed</code> ，查看Issues中出现此问题<a target="_blank" rel="noopener" href="https://github.com/jcjohnson/neural-style/issues/15">Ends abruptly with the message: Killed </a><br>在命令末尾加上 <code>-image_size 256</code> 即可，原因好像是内存分配问题导致进程被杀死。<br>截止到此，成功跑起来，运行代码。</p>
<p><code>th neural_style.lua -style_image examples/inputs/test1.jpg -content_image examples/inputs/test0.jpg -gpu -1 -image_size 256</code></p>
<p>以下 <code>Iteration 50 / 1000</code> 表示迭代周期，在CPU模式下进行，大概50分钟可以算出来<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Capturing style target 1	</span><br><span class="line">Running optimization with L-BFGS	</span><br><span class="line">&lt;optim.lbfgs&gt; 	creating recyclable direction/step/history buffers	</span><br><span class="line">Iteration 50 / 1000	</span><br><span class="line">  Content 1 loss: 3137684.062500	</span><br><span class="line">  Style 1 loss: 24579.841614	</span><br><span class="line">  Style 2 loss: 402988.671875	</span><br><span class="line">  Style 3 loss: 206954.541016	</span><br><span class="line">  Style 4 loss: 1519436.718750	</span><br><span class="line">  Style 5 loss: 4940.230560	</span><br><span class="line">  Total loss: 5296584.066315	</span><br><span class="line">Iteration 100 / 1000	</span><br><span class="line">  Content 1 loss: 2293927.968750	</span><br><span class="line">  Style 1 loss: 10807.684326	</span><br><span class="line">  Style 2 loss: 104236.169434	</span><br><span class="line">  Style 3 loss: 72638.903809	</span><br><span class="line">  Style 4 loss: 696868.261719	</span><br><span class="line">  Style 5 loss: 4750.508499	</span><br><span class="line">  Total loss: 3183229.496536	</span><br><span class="line">Iteration 150 / 1000	</span><br><span class="line">  Content 1 loss: 2009629.531250	</span><br><span class="line">  Style 1 loss: 6019.753647	</span><br><span class="line">  Style 2 loss: 53772.943115	</span><br><span class="line">  Style 3 loss: 46527.423096	</span><br><span class="line">  Style 4 loss: 598785.595703	</span><br><span class="line">  Style 5 loss: 5068.376923	</span><br><span class="line">  Total loss: 2719803.623734	</span><br><span class="line">Iteration 200 / 1000	</span><br><span class="line">  Content 1 loss: 1873752.343750	</span><br><span class="line">  Style 1 loss: 4074.698257	</span><br><span class="line">  Style 2 loss: 33790.167236	</span><br><span class="line">  Style 3 loss: 36095.117188	</span><br><span class="line">  Style 4 loss: 563354.492188	</span><br><span class="line">  Style 5 loss: 5103.339767	</span><br><span class="line">  Total loss: 2516170.158386	</span><br><span class="line">Iteration 250 / 1000	</span><br><span class="line">  Content 1 loss: 1798739.218750	</span><br><span class="line">  Style 1 loss: 3052.088928	</span><br><span class="line">  Style 2 loss: 24353.424072	</span><br><span class="line">  Style 3 loss: 31327.365112	</span><br><span class="line">  Style 4 loss: 547528.515625	</span><br><span class="line">  Style 5 loss: 5063.606644	</span><br><span class="line">  Total loss: 2410064.219131	</span><br></pre></td></tr></table></figure><br>项目主页还有关于详细命令设置<br><code>th neural_style.lua -style_image examples/inputs/picasso_selfport1907.jpg -content_image examples/inputs/brad_pitt.jpg -output_image profile.png -model_file models/nin_imagenet_conv.caffemodel -proto_file models/train_val.prototxt -gpu 0 -backend clnn -num_iterations 1000 -seed 123 -content_layers relu0,relu3,relu7,relu12 -style_layers relu0,relu3,relu7,relu12 -content_weight 10 -style_weight 1000 -image_size 512 -optimizer adam</code></p>
<p><code>-gpu -1</code> 表示没有显卡运行</p>
<h1 id="GPU模式下运行"><a href="#GPU模式下运行" class="headerlink" title="GPU模式下运行"></a>GPU模式下运行</h1><p>博主有气无力，硬件太烂，显卡还不是NAVID的，只是搜罗了几篇，供以后赞考<br><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/e1f9126846ff">深度学习neural-style环境搭建 | 简书</a></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">HibisciDai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://hibiscidai.com/2017/04/08/2017-04-08-神经网络风格画-Neural-Style-Art/">http://hibiscidai.com/2017/04/08/2017-04-08-神经网络风格画-Neural-Style-Art/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://hibiscidai.com">HibisciDai</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AE%97%E6%B3%95/">算法</a><a class="post-meta__tags" href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E9%A3%8E%E6%A0%BC%E7%94%BB/">神经网络风格画</a></div><div class="social-share pull-right" data-disabled="linkedin,diandian"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2017/05/03/2017-05-03-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E6%A6%82%E8%BF%B0VSSCVSSVNGit%E6%AF%94%E8%BE%83Windows%E4%B8%8BSVN%E6%90%AD%E5%BB%BA%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D/"><i class="fa fa-chevron-left">  </i><span>版本控制概述|VSS/CVS/SVN/Git比较|Windows下SVN搭建详细介绍</span></a></div><div class="next-post pull-right"><a href="/2017/04/08/2017-04-08-JAVA%E9%9A%8F%E6%9C%BA%E6%95%B0%E7%94%9F%E6%88%90/"><span>JAVA随机数生成 | Math.random()方法 | 随机生成int、double类型</span><i class="fa fa-chevron-right"></i></a></div></nav><div class="post-adv"><a target="_blank" rel="noopener" href="https://xn--mesr8b36x.agency/#/register?code=R5RS1JHy">好用、实惠、稳定的梯子,点击这里<img src="https://pic.imgdb.cn/item/65572abac458853aefef30cd.png" width="1000" height="124" object-fit="cover" ></a></div><div id="lv-container" data-id="city" data-uid="MTAyMC8zNTQ2NC8xMjAwMA=="><script>(function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
})(document, 'script');</script></div></div></div><footer class="footer-bg" style="background-image: url(/img/banner2.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2024 By HibisciDai</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script src="/js/search/local-search.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" data-click="false"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>